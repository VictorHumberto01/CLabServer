# CLab Server Documentation

## Overview

CLab Server is the backend infrastructure for the CLab IDE. It provides code compilation, user management, and educational features for C programming.

## Feature Status

| Feature              | Status             | Description                                                                      |
| :------------------- | :----------------- | :------------------------------------------------------------------------------- |
| **Code Compilation** | ‚úÖ **Done**        | Core logic to compile/run C code with `gcc` and `firejail` sandbox.              |
| **AI Analysis**      | ‚úÖ **Done**        | Integrated with Ollama. analyzes code on success and explains errors on failure. |
| **Authentication**   | üöß **In Progress** | Basic Login/Signup and Token Validation are implemented.                         |
| **User Roles**       | ‚è≥ **Future Work** | Admin, Teacher, and Student roles with distinct permissions.                     |
| **Exam Mode**        | ‚è≥ **Future Work** | Toggle to disable AI assistance during exams.                                    |
| **Classrooms**       | ‚è≥ **Future Work** | Grouping students, assigning lists, and tracking progress.                       |

---

## Detailed Functionality

### 1. Code Compilation & Execution

- **‚úÖ Current Implementation**:
  - Public endpoint (`POST /compile`) accepts C code and input.
  - Compiles using `gcc` and executes in a sandboxed environment (`firejail`).
  - Returns `stdout` and `stderr` or compilation errors.
  - **AI Integration**: Automatically triggers Ollama to analyze code (on success) or explain errors (on failure).
- **‚è≥ Future Work**:
  - **Authenticated Compilation**: Link compilation requests to a verified user.
  - **History Tracking**: Save every compile attempt (success/fail) and source code snapshot to the database for student history logs.

### 2. AI Code Analysis

- **‚úÖ Current Implementation**:
  - **Ollama Integration**: The server uses a local Ollama instance (model `phi3`) to generate explanations.
  - **Success Analysis**: Explains code structure, libraries used, and suggests improvements.
  - **Error Analysis**: Explains compilation errors, causes, and potential fixes.
  - The analysis is returned as part of the `CompileResponse` object.
- **‚è≥ Future Work**:
  - **Context Awareness**: Adjust explanation depth based on user proficiency.
  - **Exam Mode Blocking**: Skip this step if the user is in an active "Exam" implementation.

### 3. Authentication & User Management

- **‚úÖ Current Implementation**:
  - **Sign Up**: Basic user creation (`POST /signup`).
  - **Login**: support for JWT Tokens (`POST /login`) and HttpOnly Cookies (`POST /login/cookie`).
  - **Validation**: Middleware to protect routes (`GET /validate`).
- **‚è≥ Future Work**:
  - **Teacher-Led Registration**: Disable public signup. Students will register using specific "Invite Tokens" generated by teachers to auto-join an organization/cohort.
  - **Role-Based Access Control (RBAC)**: Enforce permissions (e.g., only Teachers can create Classrooms).

### 4. Educational Features (Classrooms & Exercises)

- **‚úÖ Current Implementation**: None.
- **‚è≥ Future Work**:
  - **Classrooms**: Containers for students managed by a Teacher.
  - **Exercise Lists**: Teachers assign specific coding references/problems.
  - **Usage Tracking**: System will track how many tries a student took for each specific exercise.

### 5. Exam Mode

- **‚úÖ Current Implementation**: None.
- **‚è≥ Future Work**:
  - **Toggle**: A boolean state set by the Teacher for a specific Classroom.
  - **Effect**: server bypasses the `GetAIAnalysis` call for students in that classroom.

---

## API Routes Documentation

### ‚úÖ Implemented Routes

#### System

| Method | Endpoint  | Description                           | Auth Required |
| :----- | :-------- | :------------------------------------ | :------------ |
| `GET`  | `/health` | Health check to verify server status. | No            |

#### Compilation

| Method | Endpoint   | Description                                                    | Auth Required  |
| :----- | :--------- | :------------------------------------------------------------- | :------------- |
| `POST` | `/compile` | Compile C code. Returns output AND AI analysis (if available). | No (Currently) |

#### Authentication

| Method | Endpoint        | Description                                            | Auth Required |
| :----- | :-------------- | :----------------------------------------------------- | :------------ |
| `POST` | `/signup`       | Create a new user account.                             | No            |
| `POST` | `/login`        | Authenticate and receive a JWT token in response body. | No            |
| `POST` | `/login/cookie` | Authenticate and set a JWT in an HttpOnly cookie.      | No            |
| `GET`  | `/validate`     | Check if the current token/session is valid.           | **Yes**       |

### ‚è≥ Planned Routes (Future)

#### Classrooms (Teachers)

| Method | Endpoint                 | Description                             |
| :----- | :----------------------- | :-------------------------------------- |
| `POST` | `/classrooms`            | Create a new classroom.                 |
| `GET`  | `/classrooms/:id`        | Get classroom details and student list. |
| `POST` | `/classrooms/:id/mode`   | Toggle **Exam Mode** on/off.            |
| `POST` | `/classrooms/:id/invite` | Generate a student invite code.         |

#### Exercises

| Method | Endpoint              | Description                                             |
| :----- | :-------------------- | :------------------------------------------------------ |
| `GET`  | `/exercises/:list_id` | Get a list of assigned exercises.                       |
| `GET`  | `/history`            | Get user's compilation history for a specific exercise. |
